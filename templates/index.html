<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google æ–°èæŸ¥è©¢ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body {
            background-color: #f0f2f5;
            font-family: "Microsoft JhengHei", sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            flex: 1;
        }

        .search-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .instruction-table th {
            background-color: #f8f9fa;
            width: 30%;
        }

        .summary-box {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-size: 0.85rem;
            color: #555;
        }

        .date-cell {
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            color: #0d6efd;
            white-space: nowrap;
        }

        code {
            color: #d63384;
            background: #f8f9fa;
            padding: 2px 4px;
            border-radius: 4px;
        }

        /* é å°¾æ¨£å¼å„ªåŒ– */
        #footer {
            background-color: #e9ecef;
            color: #6c757d;
            padding: 20px 0;
            text-align: center;
            font-size: 0.9rem;
            border-top: 1px solid #dee2e6;
            margin-top: 40px;
        }
    </style>
</head>

<body class="py-4">

    <div class="container">
        <div class="search-panel p-4 mb-4">
            <h3 class="mb-4 text-primary fw-bold">ğŸ“° Google æ–°èæŸ¥è©¢ç³»çµ±</h3>

            <div class="accordion mb-4" id="instructionAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseOne">
                            ğŸ’¡ å¦‚ä½•ä½¿ç”¨é«˜ç´šæœå°‹æŒ‡ä»¤ï¼Ÿ (é»æ“Šå±•é–‹èªªæ˜)
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#instructionAccordion">
                        <div class="accordion-body">
                            <table class="table table-bordered instruction-table mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>æŒ‡ä»¤åç¨±</th>
                                        <th>è¼¸å…¥ç¯„ä¾‹</th>
                                        <th>èªªæ˜</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>" "</code> (é›™å¼•è™Ÿ)</td>
                                        <td><code>"æ²™å´™è¾²å ´"</code></td>
                                        <td><strong>ç²¾æº–æœå°‹ï¼š</strong> å¿…é ˆå®Œå…¨ç¬¦åˆæ‹¬è™Ÿå…§çš„å­—ä¸²èˆ‡é †åºã€‚</td>
                                    </tr>
                                    <tr>
                                        <td><code>-</code> (æ¸›è™Ÿ)</td>
                                        <td><code>æ²™å´™è¾²å ´ -å…‰é›»</code></td>
                                        <td><strong>æ’é™¤é—œéµå­—ï¼š</strong> æœå°‹çµæœä¸­ä¸å¾—å‡ºç¾æ¸›è™Ÿå¾Œçš„è©å½™ã€‚</td>
                                    </tr>
                                    <tr>
                                        <td><code>OR</code> (æˆ–)</td>
                                        <td><code>å°å— OR é«˜é›„</code></td>
                                        <td><strong>è¯é›†æœå°‹ï¼š</strong> æœå°‹åŒ…å«ã€Œå°å—ã€æˆ–ã€Œé«˜é›„ã€å…¶ä¸­ä¹‹ä¸€çš„æ–°èã€‚</td>
                                    </tr>
                                    <tr>
                                        <td><code>intitle:</code></td>
                                        <td><code>intitle:æ²™å´™è¾²å ´</code></td>
                                        <td><strong>é™å®šæ¨™é¡Œï¼š</strong> åªåœ¨æ–°èæ¨™é¡Œä¸­å°‹æ‰¾è©²é—œéµå­—ã€‚</td>
                                    </tr>
                                    <tr>
                                        <td><code>site:</code></td>
                                        <td><code>æ²™å´™ site:ltn.com.tw</code></td>
                                        <td><strong>æŒ‡å®šç¶²ç«™ï¼š</strong> åªæœå°‹ç‰¹å®šåª’é«”ï¼ˆå¦‚è‡ªç”±æ™‚å ±ï¼‰ã€‚</td>
                                    </tr>
                                    <tr>
                                        <td><code>( )</code> (å°æ‹¬è™Ÿ)</td>
                                        <td><code>(å°å— OR é«˜é›„) æ²™å´™</code></td>
                                        <td><strong>é‚è¼¯åˆ†çµ„ï¼š</strong> æœå°‹åŒ…å«ã€Œæ²™å´™ã€ä¸”åŒ…å«ã€Œå°å—ã€æˆ–ã€Œé«˜é›„ã€çš„æ–°èã€‚</td>
                                    </tr>
                                    <tr>
                                        <td><code>AROUND(n)</code></td>
                                        <td><code>æ²™å´™ AROUND(5) è¾²å ´</code></td>
                                        <td><strong>è·é›¢æœå°‹ï¼š</strong> å…©å­—è©ä¹‹é–“çš„é–“éš”ä¸å¾—è¶…é n å€‹å­—ã€‚</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label fw-bold">æœå°‹é—œéµå­— / æŒ‡ä»¤çµ„åˆ</label>
                    <input type="text" id="keyword" class="form-control form-control-lg" placeholder='è¼¸å…¥é—œéµå­—ï¼Œå¦‚ï¼šæ²™å´™'>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">é–‹å§‹æ—¥æœŸ</label>
                    <input type="date" id="startDate" class="form-control form-control-lg">
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">çµæŸæ—¥æœŸ</label>
                    <input type="date" id="endDate" class="form-control form-control-lg">
                </div>
                <div class="col-12 mt-4 d-flex gap-2">
                    <button onclick="fetchNews()" class="btn btn-primary btn-lg flex-grow-1">åŸ·è¡ŒæŸ¥è©¢</button>
                    <button id="exportBtn" onclick="exportToExcel()" class="btn btn-success btn-lg"
                        style="display:none;">ğŸ“¥ åŒ¯å‡º Excel</button>
                </div>
            </div>
        </div>

        <div id="status" class="mb-3 text-center fw-bold text-secondary"></div>

        <div class="table-responsive shadow-sm border rounded">
            <table class="table table-hover align-middle bg-white mb-0">
                <thead class="table-dark">
                    <tr>
                        <th width="10%">åª’é«”</th>
                        <th width="40%">æ–°èæ¨™é¡Œ</th>
                        <th width="30%">å…§å®¹æ‘˜è¦</th>
                        <th width="20%">ç™¼ä½ˆæ™‚é–“ (æ–°â†’èˆŠ)</th>
                    </tr>
                </thead>
                <tbody id="resultBody"></tbody>
            </table>
        </div>
    </div>

    <footer id="footer">
        Â© 2026 ä¸­èˆˆå·¥ç¨‹é¡§å•è‚¡ä»½æœ‰é™å…¬å¸åœ’è·¯éƒ¨ç¶­è­·ç®¡ç†
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let currentNews = [];

        function stripHTML(html) {
            let doc = new DOMParser().parseFromString(html, 'text/html');
            return doc.body.textContent || "";
        }

        async function fetchNews() {
            const q = document.getElementById('keyword').value;
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            const status = document.getElementById('status');
            const tbody = document.getElementById('resultBody');

            if (!q) return alert("è«‹è¼¸å…¥æœå°‹æŒ‡ä»¤");
            status.innerHTML = `<div class="spinner-border spinner-border-sm"></div> æœå°‹ä¸­...`;
            tbody.innerHTML = "";

            try {
                const resp = await fetch(`/api/news?q=${encodeURIComponent(q)}&start=${start}&end=${end}`);
                const data = await resp.json();

                if (!data.length) {
                    status.innerText = "æŸ¥ç„¡çµæœï¼Œè«‹å˜—è©¦èª¿æ•´æŒ‡ä»¤ã€‚";
                    document.getElementById('exportBtn').style.display = "none";
                    return;
                }

                currentNews = data;
                status.innerText = `æ‰¾åˆ° ${data.length} å‰‡æ–°è`;
                document.getElementById('exportBtn').style.display = "block";

                tbody.innerHTML = data.map(n => `
                <tr>
                    <td><span class="badge bg-light text-dark border">${n.source}</span></td>
                    <td><a href="${n.link}" target="_blank" class="text-decoration-none text-dark fw-bold">${n.title}</a></td>
                    <td><div class="summary-box">${stripHTML(n.summary)}</div></td>
                    <td class="date-cell">${n.pubDate}</td>
                </tr>
            `).join('');

            } catch (err) {
                status.innerText = "é€£ç·šå¤±æ•—ã€‚";
            }
        }

        function exportToExcel() {
            if (!currentNews.length) return;

            const q = document.getElementById('keyword').value || "æœªå‘½åé—œéµå­—";
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;

            const exportData = currentNews.map(n => ({
                "åª’é«”": n.source,
                "æ¨™é¡Œ": n.title,
                "æ‘˜è¦": stripHTML(n.summary),
                "ç™¼ä½ˆæ™‚é–“": n.pubDate,
                "æ–°èé€£çµ": n.link
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "NewsData");

            ws['!cols'] = [{ wch: 15 }, { wch: 50 }, { wch: 60 }, { wch: 25 }, { wch: 40 }];

            let filename = `æ–°èåŒ¯å‡º_${q}`;

            if (start && end) {
                filename += `_${start}_è‡³_${end}`;
            } else if (start) {
                filename += `_${start}_èµ·`;
            } else if (end) {
                filename += `_æˆªè‡³_${end}`;
            }

            XLSX.writeFile(wb, `${filename}.xlsx`);
        }
    </script>
</body>

</html>